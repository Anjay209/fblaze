<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FBLAZE Dashboard</title>
  <link rel="stylesheet" href="leaderboard.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDGYp9sBwOWBdu9W46Q6XFp9zfLCrEsaO4",
  authDomain: "certquest-94959.firebaseapp.com",
  projectId: "certquest-94959",
  storageBucket: "certquest-94959.firebasestorage.app",
  messagingSenderId: "323956529033",
  appId: "1:323956529033:web:e9c9c6a3c7668b8a72f358",
  measurementId: "G-F5JHTGGN6K"
};
if (!firebase.apps.length) {
  firebase.initializeApp(firebaseConfig);
}
</script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
<script type="module" src="/js/firebase.js"></script></head>
<body>

  <!-- Top Nav -->
  <div class="top-header">
    <div class="nav-left">üåê</div>
    <div class="nav-title">Dashboard <span class="new-badge">(New!)</span></div>
    <div class="nav-right">
  <input type="text" id="navbarSearch" placeholder="Search CertQuest..." />
  <span class="search-icon" id="navbarSearchIcon">üîç</span>
  <div id="searchDropdown"></div>
</div>
  </div>

  <div class="main-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">FB</div>
      <ul class="nav-icons">
  <li>
     <a href="/Public/home.html">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 3L20 9V21H15V15H9V21H4V9L12 3Z" fill="#3b82f6" fill-opacity="0.3"/>
      <path d="M12 3L4 9V21H9V15H15V21H20V9L12 3Z" stroke="#3b82f6" stroke-width="2" fill="none" stroke-linejoin="round"/>
      <rect x="10" y="17" width="4" height="4" fill="#3b82f6"/>
      <rect x="6" y="11" width="2" height="2" fill="#3b82f6"/>
      <rect x="16" y="11" width="2" height="2" fill="#3b82f6"/>
    </svg>
    
    <span class="nav-label">Home</span>
     </a>
  </li>
  <li>
  <a href="#" onclick="openNotificationsOnHome(); return false;">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <!-- Bell body main fill -->
    <path d="M18 8C18 6.4087 17.3679 4.88258 16.2426 3.75736C15.1174 2.63214 13.5913 2 12 2C10.4087 2 8.88258 2.63214 7.75736 3.75736C6.63214 4.88258 6 6.4087 6 8C6 15 3 17 3 17H21C21 17 18 15 18 8Z" fill="#3b82f6" fill-opacity="0.3"/>
    <!-- Bell body lighter overlay -->
    <path d="M18 8C18 6.4087 17.3679 4.88258 16.2426 3.75736C15.1174 2.63214 13.5913 2 12 2C10.4087 2 8.88258 2.63214 7.75736 3.75736C6.63214 4.88258 6 6.4087 6 8C6 12 6 15 6 15H18C18 15 18 12 18 8Z" fill="#3b82f6" fill-opacity="0.2"/>
    <!-- Bell outline -->
    <path d="M18 8C18 6.4087 17.3679 4.88258 16.2426 3.75736C15.1174 2.63214 13.5913 2 12 2C10.4087 2 8.88258 2.63214 7.75736 3.75736C6.63214 4.88258 6 6.4087 6 8C6 15 3 17 3 17H21C21 17 18 15 18 8Z" stroke="#3b82f6" stroke-width="2" fill="none"/>
    <!-- Bell clapper -->
    <circle cx="12" cy="8" r="1" fill="#3b82f6"/>
    <!-- Sound waves -->
    <path d="M19 4L20 3" stroke="#3b82f6" stroke-width="1.5" stroke-linecap="round" opacity="0.5"/>
    <path d="M20.5 6.5L22 6" stroke="#3b82f6" stroke-width="1.5" stroke-linecap="round" opacity="0.3"/>
    <path d="M5 4L4 3" stroke="#3b82f6" stroke-width="1.5" stroke-linecap="round" opacity="0.5"/>
    <path d="M3.5 6.5L2 6" stroke="#3b82f6" stroke-width="1.5" stroke-linecap="round" opacity="0.3"/>
    <!-- Bottom notification indicator -->
    <path d="M13.73 21C13.5542 21.3031 13.3019 21.5547 12.9982 21.7295C12.6946 21.9044 12.3504 21.9965 12 21.9965C11.6496 21.9965 11.3054 21.9044 11.0018 21.7295C10.6982 21.5547 10.4458 21.3031 10.27 21" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"/>
  </svg>
  <span class="nav-label">Notifications</span>
</a>
</li>
  <li>
    <a href="/Public/practice.html">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="12" cy="12" r="9" fill="#3b82f6" fill-opacity="0.3"/>
      <circle cx="12" cy="12" r="6" fill="#3b82f6" fill-opacity="0.2"/>
      <circle cx="12" cy="12" r="9" stroke="#3b82f6" stroke-width="2" fill="none"/>
      <circle cx="12" cy="12" r="6" stroke="#3b82f6" stroke-width="1.5" fill="none"/>
      <circle cx="12" cy="12" r="3" stroke="#3b82f6" stroke-width="1.5" fill="none"/>
      <circle cx="12" cy="12" r="1.5" fill="#3b82f6"/>
      <path d="M16 8L12 12L16 8Z" fill="#3b82f6"/>
      <line x1="16" y1="8" x2="19" y2="5" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <span class="nav-label">Practice</span>
    </a>
  </li>
  <li>
    <a href="/Public/Forum/forum.html">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M8 6C8 4.89543 8.89543 4 10 4H18C19.1046 4 20 4.89543 20 6V12C20 13.1046 19.1046 14 18 14H12L8 18V6Z" fill="#3b82f6" fill-opacity="0.3"/>
      <path d="M4 10C4 8.89543 4.89543 8 6 8H8V16L4 20V12C4 11.4477 4.44772 11 5 11C4.44772 11 4 10.5523 4 10Z" fill="#3b82f6" fill-opacity="0.2"/>
      <path d="M8 6C8 4.89543 8.89543 4 10 4H18C19.1046 4 20 4.89543 20 6V12C20 13.1046 19.1046 14 18 14H12L8 18V6Z" stroke="#3b82f6" stroke-width="2" fill="none"/>
      <path d="M4 10C4 8.89543 4.89543 8 6 8H8V16L4 20V12C4 11.4477 4.44772 11 5 11C4.44772 11 4 10.5523 4 10Z" stroke="#3b82f6" stroke-width="1.5" fill="none"/>
      <line x1="11" y1="8" x2="17" y2="8" stroke="#3b82f6" stroke-width="1.5" stroke-linecap="round"/>
      <line x1="11" y1="10" x2="15" y2="10" stroke="#3b82f6" stroke-width="1.5" stroke-linecap="round"/>
    </svg>
    <span class="nav-label">Forum</span>
    </a>
  </li>
  <li>
     <a href="/Public/Calendar/calendar1.html">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect x="3" y="6" width="18" height="15" rx="2" fill="#3b82f6" fill-opacity="0.3"/>
      <rect x="3" y="6" width="18" height="4" rx="2" fill="#3b82f6" fill-opacity="0.2"/>
      <rect x="3" y="6" width="18" height="15" rx="2" stroke="#3b82f6" stroke-width="2" fill="none"/>
      <line x1="7" y1="3" x2="7" y2="7" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"/>
      <line x1="17" y1="3" x2="17" y2="7" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"/>
      <line x1="3" y1="10" x2="21" y2="10" stroke="#3b82f6" stroke-width="1" opacity="0.5"/>
      <line x1="7.5" y1="10" x2="7.5" y2="21" stroke="#3b82f6" stroke-width="1" opacity="0.3"/>
      <line x1="12" y1="10" x2="12" y2="21" stroke="#3b82f6" stroke-width="1" opacity="0.3"/>
      <line x1="16.5" y1="10" x2="16.5" y2="21" stroke="#3b82f6" stroke-width="1" opacity="0.3"/>
      <circle cx="9" cy="13" r="1" fill="#3b82f6"/>
      <circle cx="15" cy="16" r="1" fill="#3b82f6"/>
      <circle cx="12" cy="18" r="1" fill="#3b82f6"/>
    </svg>
    <span class="nav-label">Calendar</span>
     </a>
  </li>
</ul>
    </aside>
      <div class="container">
        <span class="title">Leaderboards</span>
        <p class="subtitle">
          See where you stand and climb the ranks at CertQuest! Get on the leaderboard by gaining XP, mentoring others, and more.
        </p>
        <div class="tabs">
          <button class="active">This week</button>
          <button>This month</button>
          <button>All time</button>
        </div>
    
        <!-- Leaderboards -->
      <section style="display:flex; gap:2rem; flex-wrap:wrap;">
        <!-- Learners -->
        <div class="board">
          <h2 style="margin-bottom:1rem;">Most SP (Learners)</h2>
          <ol style="list-style:none; padding:0; margin:0;">
            <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
              <div><span>ü•á</span> Isaac T</div>
              <div style="font-weight:bold;">190 SP</div>
            </li>
            <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
              <div><span>ü•à</span> Sam S</div>
              <div style="font-weight:bold;">175 SP</div>
            </li>
            <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
              <div><span>ü•â</span> Emma L</div>
              <div style="font-weight:bold;">155 SP</div>
            </li>
            <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
              <div>Cadence B</div>
              <div style="font-weight:bold;">155 SP</div>
            </li>
            <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
                <div>Cadence B</div>
                <div style="font-weight:bold;">155 SP</div>
              </li>
              <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
                <div>Cadence B</div>
                <div style="font-weight:bold;">155 SP</div>
              </li>
              <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
                  <div>Cadence B</div>
                  <div style="font-weight:bold;">155 SP</div>
                </li>
                <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
                    <div>Cadence B</div>
                    <div style="font-weight:bold;">155 SP</div>
                  </li>
                  <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
                      <div>Cadence B</div>
                      <div style="font-weight:bold;">155 SP</div>
                    </li>
                    <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
                        <div>Cadence B</div>
                        <div style="font-weight:bold;">155 SP</div>
                      </li>
          </ol>
        </div>

        <!-- Tutors -->
        <div class="board">
          <h2 style="margin-bottom:1rem;">Most SP (Tutors)</h2>
          <ol style="list-style:none; padding:0; margin:0;">
            <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
              <div><span>ü•á</span> Long T</div>
              <div style="font-weight:bold;">1348 SP</div>
            </li>
            <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
              <div><span>ü•à</span> Thomas S</div>
              <div style="font-weight:bold;">302 SP</div>
            </li>
            <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
              <div><span>ü•â</span> Sanjana S</div>
              <div style="font-weight:bold;">291 SP</div>
            </li>
            
              <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
                <div>Cadence B</div>
                <div style="font-weight:bold;">155 SP</div>
              </li>
              <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
                <div>Cadence B</div>
                <div style="font-weight:bold;">155 SP</div>
              </li>
              <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
                <div>Cadence B</div>
                <div style="font-weight:bold;">155 SP</div>
              </li>
              <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
                  <div>Cadence B</div>
                  <div style="font-weight:bold;">155 SP</div>
                </li>
                <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
                    <div>Cadence B</div>
                    <div style="font-weight:bold;">155 SP</div>
                  </li>
                  <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
                      <div>Cadence B</div>
                      <div style="font-weight:bold;">155 SP</div>
                    </li>
                    <li style="padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center;">
                        <div>Cadence B</div>
                        <div style="font-weight:bold;">155 SP</div>
                      </li>
          </ol>
        </div>
      </section>
  </div>
  <canvas id="confetti-canvas"></canvas>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/meilisearch@latest/dist/bundles/meilisearch.umd.min.js"></script>

  <script>


// Initialize Firebase (replace with your config)

const db = firebase.firestore();

// Function to fetch and display leaderboard data
async function loadLeaderboard(timeframe = 'week') {
  try {
    // Get all users from Firebase
    const usersSnapshot = await db.collection('users').get();
    const users = [];
    
    usersSnapshot.forEach(doc => {
      const userData = doc.data();
      if (userData.XP !== undefined && userData.name) {
        users.push({
          id: doc.id,
          name: userData.name,
          xp: userData.XP || 0,
          isMentor: userData.isMentor || false,
          createdAt: userData.createdAt ? userData.createdAt.toDate() : new Date()
        });
      }
    });

    // Filter by timeframe if needed
    const filteredUsers = filterByTimeframe(users, timeframe);
    
    // Separate learners and mentors based on isMentor field
    const learners = filteredUsers.filter(user => !user.isMentor);
    const mentors = filteredUsers.filter(user => user.isMentor);
    
    // Sort by XP (descending)
    learners.sort((a, b) => b.xp - a.xp);
    mentors.sort((a, b) => b.xp - a.xp);
    
    // Update the leaderboard displays
    updateLeaderboardDisplay('learners', learners.slice(0, 10));
    updateLeaderboardDisplay('mentors', mentors.slice(0, 10));
    
  } catch (error) {
    console.error('Error loading leaderboard:', error);
    showErrorMessage('Failed to load leaderboard data');
  }
}

// Function to filter users by timeframe
function filterByTimeframe(users, timeframe) {
  const now = new Date();
  let cutoffDate;
  
  switch(timeframe) {
    case 'week':
      cutoffDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
      break;
    case 'month':
      cutoffDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
      break;
    case 'alltime':
    default:
      return users; // No filtering for all-time
  }
  
  // Filter users who were active in the timeframe
  return users.filter(user => user.lastActive >= cutoffDate);
}

// Function to update leaderboard display
function updateLeaderboardDisplay(type, users) {
  const boardSelector = type === 'learners' ? 
    '.board:first-child ol' : '.board:last-child ol';
  const boardElement = document.querySelector(boardSelector);
  
  if (!boardElement) return;
  
  // Clear existing content
  boardElement.innerHTML = '';
  
  // Add users to leaderboard
  users.forEach((user, index) => {
    const listItem = document.createElement('li');
    listItem.style.cssText = 'padding:0.5rem 0; display:flex; justify-content:space-between; align-items:center; border-bottom: 1px solid #eee;';
    
    // Add medal for top 3
    let medal = '';
    if (index === 0) medal = 'ü•á';
    else if (index === 1) medal = 'ü•à';
    else if (index === 2) medal = 'ü•â';
    else medal = `${index + 1}.`;
    
    listItem.innerHTML = `
      <div style="display: flex; align-items: center; gap: 0.5rem;">
        <span style="min-width: 2rem;">${medal}</span>
        <span>${user.name}</span>
      </div>
      <div style="font-weight:bold; color: #3b82f6;">${user.xp} XP</div>
    `;
    
    boardElement.appendChild(listItem);
  });
  
  // Add empty state if no users
  if (users.length === 0) {
    boardElement.innerHTML = '<li style="padding:1rem; text-align:center; color:#888;">No data available</li>';
  }
}

// Function to show error message
function showErrorMessage(message) {
  const container = document.querySelector('.container');
  const errorDiv = document.createElement('div');
  errorDiv.style.cssText = 'background:#fee; color:#c33; padding:1rem; border-radius:8px; margin:1rem 0;';
  errorDiv.textContent = message;
  container.insertBefore(errorDiv, container.querySelector('.tabs'));
  
  // Remove error after 5 seconds
  setTimeout(() => errorDiv.remove(), 5000);
}

// Function to handle tab switching
function setupTabSwitching() {
  const tabs = document.querySelectorAll('.tabs button');
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      // Remove active class from all tabs
      tabs.forEach(t => t.classList.remove('active'));
      // Add active class to clicked tab
      tab.classList.add('active');
      
      // Get timeframe and reload leaderboard
      const timeframe = tab.textContent.toLowerCase().replace(' ', '');
      loadLeaderboard(timeframe);
    });
  });
}

// Function to add real-time updates
function setupRealtimeUpdates() {
  // Listen for changes in users collection
  db.collection('users').onSnapshot((snapshot) => {
    console.log('User data updated, refreshing leaderboard...');
    const activeTab = document.querySelector('.tabs button.active');
    const timeframe = activeTab ? activeTab.textContent.toLowerCase().replace(' ', '') : 'week';
    loadLeaderboard(timeframe);
  });
}

// Function to add loading state
function showLoadingState() {
  const boards = document.querySelectorAll('.board ol');
  boards.forEach(board => {
    board.innerHTML = '<li style="padding:1rem; text-align:center; color:#888;">Loading...</li>';
  });
}

// Replace the existing window.onload function with this:
window.onload = () => {
  // Confetti animation
  const canvas = document.getElementById('confetti-canvas');
  const myConfetti = confetti.create(canvas, { resize: true });

  myConfetti({
    particleCount: 500,
    spread: 80,
    origin: { y: 1.0 },
    startVelocity: 140,
    gravity: 0,
    ticks: 50000000
  });

  // Initialize leaderboard functionality
  showLoadingState();
  setupTabSwitching();
  loadLeaderboard('week'); // Load initial data for "This week"
  setupRealtimeUpdates(); // Enable real-time updates

  // Keep existing Meilisearch code...
  const client = new MeiliSearch({ host: 'http://127.0.0.1:7700' });
  const index = client.index('content');
  const searchBox = document.getElementById('navbarSearch');
  const searchDropdown = document.getElementById('searchDropdown');
  const searchIcon = document.getElementById('navbarSearchIcon');

  // ... rest of existing Meilisearch code stays the same
};

// Optional: Function to manually refresh leaderboard
function refreshLeaderboard() {
  const activeTab = document.querySelector('.tabs button.active');
  const timeframe = activeTab ? activeTab.textContent.toLowerCase().replace(' ', '') : 'week';
  showLoadingState();
  loadLeaderboard(timeframe);
}
function openNotificationsOnHome() {
    // Set a flag in sessionStorage (gets cleared when browser is closed)
    sessionStorage.setItem('openNotifications', 'true');
    // Navigate to home page - CHANGE THIS PATH to match your structure
    window.location.href = 'public/home.html';
}

    

  </script>



  
</body>
</html>