<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CertQuest Dashboard</title>
  <link rel="stylesheet" href="dashboard.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/feather-icons"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/meilisearch@latest/dist/bundles/meilisearch.umd.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
  


</head>
<body>

  <!-- Top Nav -->
  <div class="top-header">
    <div class="nav-left">üåê</div>
    <div class="nav-title">Dashboard <span class="new-badge">(New!)</span></div>
    <div class="nav-right">
      <input type="text" id="navbarSearch" placeholder="Search CertQuest..." />
      <span class="search-icon" id="navbarSearchIcon">üîç</span>
      <div id="searchDropdown"></div>
    </div>
  </div>

  <div class="main-layout">
    <!-- Sidebar -->
      <aside class="sidebar">
      <div class="logo">CQ</div>
      <ul class="nav-icons">
  <li>
     <a href="/Public/home.html">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 3L20 9V21H15V15H9V21H4V9L12 3Z" fill="#3b82f6" fill-opacity="0.3"/>
      <path d="M12 3L4 9V21H9V15H15V21H20V9L12 3Z" stroke="#3b82f6" stroke-width="2" fill="none" stroke-linejoin="round"/>
      <rect x="10" y="17" width="4" height="4" fill="#3b82f6"/>
      <rect x="6" y="11" width="2" height="2" fill="#3b82f6"/>
      <rect x="16" y="11" width="2" height="2" fill="#3b82f6"/>
    </svg>
    
    <span class="nav-label">Home</span>
     </a>
  </li>
  <li>
  <a href="javascript:void(0)" onclick="toggleCommentPanel()">  
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <!-- Bell body main fill -->
      <path d="M18 8C18 6.4087 17.3679 4.88258 16.2426 3.75736C15.1174 2.63214 13.5913 2 12 2C10.4087 2 8.88258 2.63214 7.75736 3.75736C6.63214 4.88258 6 6.4087 6 8C6 15 3 17 3 17H21C21 17 18 15 18 8Z" fill="#3b82f6" fill-opacity="0.3"/>
      
      <!-- Bell body lighter overlay -->
      <path d="M18 8C18 6.4087 17.3679 4.88258 16.2426 3.75736C15.1174 2.63214 13.5913 2 12 2C10.4087 2 8.88258 2.63214 7.75736 3.75736C6.63214 4.88258 6 6.4087 6 8C6 12 6 15 6 15H18C18 15 18 12 18 8Z" fill="#3b82f6" fill-opacity="0.2"/>
      
      <!-- Bell outline -->
      <path d="M18 8C18 6.4087 17.3679 4.88258 16.2426 3.75736C15.1174 2.63214 13.5913 2 12 2C10.4087 2 8.88258 2.63214 7.75736 3.75736C6.63214 4.88258 6 6.4087 6 8C6 15 3 17 3 17H21C21 17 18 15 18 8Z" stroke="#3b82f6" stroke-width="2" fill="none"/>
      
      <!-- Bell clapper -->
      <circle cx="12" cy="8" r="1" fill="#3b82f6"/>
      
      <!-- Sound waves -->
      <path d="M19 4L20 3" stroke="#3b82f6" stroke-width="1.5" stroke-linecap="round" opacity="0.5"/>
      <path d="M20.5 6.5L22 6" stroke="#3b82f6" stroke-width="1.5" stroke-linecap="round" opacity="0.3"/>
      <path d="M5 4L4 3" stroke="#3b82f6" stroke-width="1.5" stroke-linecap="round" opacity="0.5"/>
      <path d="M3.5 6.5L2 6" stroke="#3b82f6" stroke-width="1.5" stroke-linecap="round" opacity="0.3"/>
      
      <!-- Bottom notification indicator -->
      <path d="M13.73 21C13.5542 21.3031 13.3019 21.5547 12.9982 21.7295C12.6946 21.9044 12.3504 21.9965 12 21.9965C11.6496 21.9965 11.3054 21.9044 11.0018 21.7295C10.6982 21.5547 10.4458 21.3031 10.27 21" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <span class="nav-label">Notifications</span>
  </a>
</li>
  <li>
    <a href="/Public/practice.html">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="12" cy="12" r="9" fill="#3b82f6" fill-opacity="0.3"/>
      <circle cx="12" cy="12" r="6" fill="#3b82f6" fill-opacity="0.2"/>
      <circle cx="12" cy="12" r="9" stroke="#3b82f6" stroke-width="2" fill="none"/>
      <circle cx="12" cy="12" r="6" stroke="#3b82f6" stroke-width="1.5" fill="none"/>
      <circle cx="12" cy="12" r="3" stroke="#3b82f6" stroke-width="1.5" fill="none"/>
      <circle cx="12" cy="12" r="1.5" fill="#3b82f6"/>
      <path d="M16 8L12 12L16 8Z" fill="#3b82f6"/>
      <line x1="16" y1="8" x2="19" y2="5" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <span class="nav-label">Practice</span>
    </a>
  </li>
  <li>
    <a href="/Public/Forum/forum.html">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M8 6C8 4.89543 8.89543 4 10 4H18C19.1046 4 20 4.89543 20 6V12C20 13.1046 19.1046 14 18 14H12L8 18V6Z" fill="#3b82f6" fill-opacity="0.3"/>
      <path d="M4 10C4 8.89543 4.89543 8 6 8H8V16L4 20V12C4 11.4477 4.44772 11 5 11C4.44772 11 4 10.5523 4 10Z" fill="#3b82f6" fill-opacity="0.2"/>
      <path d="M8 6C8 4.89543 8.89543 4 10 4H18C19.1046 4 20 4.89543 20 6V12C20 13.1046 19.1046 14 18 14H12L8 18V6Z" stroke="#3b82f6" stroke-width="2" fill="none"/>
      <path d="M4 10C4 8.89543 4.89543 8 6 8H8V16L4 20V12C4 11.4477 4.44772 11 5 11C4.44772 11 4 10.5523 4 10Z" stroke="#3b82f6" stroke-width="1.5" fill="none"/>
      <line x1="11" y1="8" x2="17" y2="8" stroke="#3b82f6" stroke-width="1.5" stroke-linecap="round"/>
      <line x1="11" y1="10" x2="15" y2="10" stroke="#3b82f6" stroke-width="1.5" stroke-linecap="round"/>
    </svg>
    <span class="nav-label">Forum</span>
    </a>
  </li>
  <li>
     <a href="/Public/Calendar/calendar.html">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect x="3" y="6" width="18" height="15" rx="2" fill="#3b82f6" fill-opacity="0.3"/>
      <rect x="3" y="6" width="18" height="4" rx="2" fill="#3b82f6" fill-opacity="0.2"/>
      <rect x="3" y="6" width="18" height="15" rx="2" stroke="#3b82f6" stroke-width="2" fill="none"/>
      <line x1="7" y1="3" x2="7" y2="7" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"/>
      <line x1="17" y1="3" x2="17" y2="7" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"/>
      <line x1="3" y1="10" x2="21" y2="10" stroke="#3b82f6" stroke-width="1" opacity="0.5"/>
      <line x1="7.5" y1="10" x2="7.5" y2="21" stroke="#3b82f6" stroke-width="1" opacity="0.3"/>
      <line x1="12" y1="10" x2="12" y2="21" stroke="#3b82f6" stroke-width="1" opacity="0.3"/>
      <line x1="16.5" y1="10" x2="16.5" y2="21" stroke="#3b82f6" stroke-width="1" opacity="0.3"/>
      <circle cx="9" cy="13" r="1" fill="#3b82f6"/>
      <circle cx="15" cy="16" r="1" fill="#3b82f6"/>
      <circle cx="12" cy="18" r="1" fill="#3b82f6"/>
    </svg>
    <span class="nav-label">Calendar</span>
     </a>
  </li>
   <li>
     <a href="/Public/tools.html">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <!-- Base building blocks with layered opacity -->
  <rect x="2" y="16" width="6" height="6" rx="1" fill="#3b82f6" fill-opacity="0.3"/>
  <rect x="9" y="12" width="6" height="10" rx="1" fill="#3b82f6" fill-opacity="0.3"/>
  <rect x="16" y="8" width="6" height="14" rx="1" fill="#3b82f6" fill-opacity="0.3"/>
  
  <!-- Lighter overlay sections -->
  <rect x="2" y="16" width="6" height="3" rx="1" fill="#3b82f6" fill-opacity="0.2"/>
  <rect x="9" y="12" width="6" height="4" rx="1" fill="#3b82f6" fill-opacity="0.2"/>
  <rect x="16" y="8" width="6" height="5" rx="1" fill="#3b82f6" fill-opacity="0.2"/>
  
  <!-- Block outlines -->
  <rect x="2" y="16" width="6" height="6" rx="1" stroke="#3b82f6" stroke-width="2" fill="none"/>
  <rect x="9" y="12" width="6" height="10" rx="1" stroke="#3b82f6" stroke-width="2" fill="none"/>
  <rect x="16" y="8" width="6" height="14" rx="1" stroke="#3b82f6" stroke-width="2" fill="none"/>
  
  <!-- Building block connection dots -->
  <circle cx="5" cy="19" r="1" fill="#3b82f6"/>
  <circle cx="12" cy="17" r="1" fill="#3b82f6"/>
  <circle cx="19" cy="15" r="1" fill="#3b82f6"/>
  
  <!-- Subtle grid lines for construction feel -->
  <line x1="2" y1="19" x2="8" y2="19" stroke="#3b82f6" stroke-width="1" opacity="0.3"/>
  <line x1="9" y1="17" x2="15" y2="17" stroke="#3b82f6" stroke-width="1" opacity="0.3"/>
  <line x1="16" y1="15" x2="22" y2="15" stroke="#3b82f6" stroke-width="1" opacity="0.3"/>
  
  <!-- Additional detail lines -->
  <line x1="5" y1="16" x2="5" y2="22" stroke="#3b82f6" stroke-width="1" opacity="0.3"/>
  <line x1="12" y1="12" x2="12" y2="22" stroke="#3b82f6" stroke-width="1" opacity="0.3"/>
  <line x1="19" y1="8" x2="19" y2="22" stroke="#3b82f6" stroke-width="1" opacity="0.3"/>
</svg>
    <span class="nav-label">Study Tools</span>
     </a>
  </li>
 
</ul>
    </aside>


     



    <!-- Main Content -->
   <!-- Main Content -->
    <main class="content">
      <div class="invite-section">
        <div class="invite-header">
          <h1>Invite a member</h1>
          <p>This is where you can see the members of your chapter on Certquest!</p>
        </div>

        <div class="pending-section">
          <h2>Pending invitations (5)</h2>
          <div class="member-grid">
            <div class="member-card">
              <div class="member-avatar">
                <img src="https://images.unsplash.com/photo-1494790108755-2616b612b786?w=40&h=40&fit=crop&crop=face" alt="Amelia Parker">
              </div>
              <div class="member-info">
                <div class="member-name">Amelia Parker</div>
                <div class="member-email">amelia.parker@e...</div>
              </div>
              <button class="delete-btn">
 
</button>
            </div>

            <div class="member-card">
              <div class="member-avatar default-avatar">
                <span>üë§</span>
              </div>
              <div class="member-info">
                <div class="member-name">Nguyen, Shane</div>
                <div class="member-email">nguyenshane@e...</div>
              </div>
             <button class="delete-btn">
  
</button>
            </div>

            <div class="member-card">
              <div class="member-avatar">
                <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=40&h=40&fit=crop&crop=face" alt="Mason Foster">
              </div>
              <div class="member-info">
                <div class="member-name">Mason Foster</div>
                <div class="member-email">mason.foster@e...</div>
              </div>
             <button class="delete-btn">
  
</button>
            </div>

            <div class="member-card">
              <div class="member-avatar purple-avatar">
                <span>E</span>
              </div>
              <div class="member-info">
                <div class="member-name">Emily Carter</div>
                <div class="member-email">emily.carter@e...</div>
              </div>
             <button class="delete-btn">
 
</button>
            </div>
          </div>
        </div>

        <div class="workspace-section">
          <h2>Workspace member (18)</h2>
          <div class="member-grid">
            <div class="member-card">
              <div class="member-avatar blue-avatar">
                <span>üë§</span>
              </div>
              <div class="member-info">
                <div class="member-name">Henry, Arthur <span class="owner-badge">Owner</span></div>
                <div class="member-email">sara.cruz@example.com</div>
              </div>
              <button class="menu-btn">‚ãÆ</button>
            </div>

            <div class="member-card">
              <div class="member-avatar green-avatar">
                <span>B</span>
              </div>
              <div class="member-info">
                <div class="member-name">Black, Marvin</div>
                <div class="member-email">blackmarvin@example.com</div>
              </div>
              <button class="menu-btn">‚ãÆ</button>
            </div>

            <div class="member-card">
              <div class="member-avatar blue-avatar">
                <span>O</span>
              </div>
              <div class="member-info">
                <div class="member-name">Olivia Martinez</div>
                <div class="member-email">oliviamartinez@exa</div>
              </div>
              <button class="menu-btn">‚ãÆ</button>
            </div>

            <div class="member-card">
              <div class="member-avatar purple-avatar">
                <span>E</span>
              </div>
              <div class="member-info">
                <div class="member-name">Emily Carter</div>
                <div class="member-email">emily.carter@example.com</div>
              </div>
              <button class="menu-btn">‚ãÆ</button>
            </div>

            <div class="member-card">
              <div class="member-avatar">
                <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=40&h=40&fit=crop&crop=face" alt="James Wright">
              </div>
              <div class="member-info">
                <div class="member-name">James Wright</div>
                <div class="member-email">james.wright@example.com</div>
              </div>
              <button class="menu-btn">‚ãÆ</button>
            </div>

            <div class="member-card">
              <div class="member-avatar orange-avatar">
                <span>S</span>
              </div>
              <div class="member-info">
                <div class="member-name">Sophia Bennett</div>
                <div class="member-email">sophia.bennett@ex</div>
              </div>
              <button class="menu-btn">‚ãÆ</button>
            </div>

            <div class="member-card">
              <div class="member-avatar">
                <img src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=40&h=40&fit=crop&crop=face" alt="Ava Mitchell">
              </div>
              <div class="member-info">
                <div class="member-name">Ava Mitchell</div>
                <div class="member-email">ava.mitchell@example.com</div>
              </div>
              <button class="menu-btn">‚ãÆ</button>
            </div>

            <div class="member-card">
              <div class="member-avatar purple-avatar">
                <span>L</span>
              </div>
              <div class="member-info">
                <div class="member-name">Liam Turner</div>
                <div class="member-email">liam.turner@example.com</div>
              </div>
              <button class="menu-btn">‚ãÆ</button>
            </div>

            <div class="member-card">
              <div class="member-avatar">
                <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=40&h=40&fit=crop&crop=face" alt="Noah Brooks">
              </div>
              <div class="member-info">
                <div class="member-name">Noah Brooks</div>
                <div class="member-email">noah.brooks@exam</div>
              </div>
              <button class="menu-btn">‚ãÆ</button>
            </div>

            <div class="member-card">
              <div class="member-avatar orange-avatar">
                <span>E</span>
              </div>
              <div class="member-info">
                <div class="member-name">Emma Sanders</div>
                <div class="member-email">emma.sanders@example...</div>
              </div>
              <button class="menu-btn">‚ãÆ</button>
            </div>

            <div class="member-card">
              <div class="member-avatar">
                <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=40&h=40&fit=crop&crop=face" alt="Benjamin Reed">
              </div>
              <div class="member-info">
                <div class="member-name">Benjamin Reed</div>
                <div class="member-email">benjamin.reed@example.c...</div>
              </div>
              <button class="menu-btn">‚ãÆ</button>
            </div>

            <div class="member-card">
              <div class="member-avatar green-avatar">
                <span>C</span>
              </div>
              <div class="member-info">
                <div class="member-name">Chloe Evans</div>
                <div class="member-email">chloe.evans@exam</div>
              </div>
              <button class="menu-btn">‚ãÆ</button>
            </div>

            <div class="member-card">
              <div class="member-avatar purple-avatar">
                <span>C</span>
              </div>
              <div class="member-info">
                <div class="member-name">Charlotte Hughes</div>
                <div class="member-email">charlotte.hughes@exampl...</div>
              </div>
              <button class="menu-btn">‚ãÆ</button>
            </div>

            <div class="member-card">
              <div class="member-avatar">
                <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=40&h=40&fit=crop&crop=face" alt="Ethan Morgan">
              </div>
              <div class="member-info">
                <div class="member-name">Ethan Morgan</div>
                <div class="member-email">ethan.morgan@example.c...</div>
              </div>
              <button class="menu-btn">‚ãÆ</button>
            </div>
          </div>
        </div>
      </div>
    </main>
    </div>

    <script>
  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyDGYp9sBwOWBdu9W46Q6XFp9zfLCrEsaO4",
    authDomain: "certquest-94959.firebaseapp.com",
    projectId: "certquest-94959",
    storageBucket: "certquest-94959.appspot.com",
    messagingSenderId: "323956529033",
    appId: "1:323956529033:web:e9c9c6a3c7668b8a72f358",
    measurementId: "G-F5JHTGGN6K"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();

  // Add this script after your Firebase initialization in the HTML file

// Function to get current advisor's school
async function getCurrentAdvisorSchool() {
  const user = auth.currentUser;
  if (!user) return null;
  
  const userDoc = await db.collection('users').doc(user.uid).get();
  if (userDoc.exists) {
    const userData = userDoc.data();
    return userData.school;
  }
  return null;
}

// Function to load pending members
async function loadPendingMembers() {
  try {
    const advisorSchool = await getCurrentAdvisorSchool();
    if (!advisorSchool) return;

    // Query users with needsApproval: true and same school
    const pendingQuery = db.collection('users')
      .where('needsApproval', '==', true)
      .where('school', '==', advisorSchool);

    const snapshot = await pendingQuery.get();
    
    // Get the pending members container
    const memberGrid = document.querySelector('.pending-section .member-grid');
    if (!memberGrid) return;

    // Clear existing content
    memberGrid.innerHTML = '';

    // Update the count in the header
    const pendingHeader = document.querySelector('.pending-section h2');
    if (pendingHeader) {
      pendingHeader.textContent = `Pending invitations (${snapshot.size})`;
    }

    // Create member cards for each pending user
    snapshot.forEach((doc) => {
      const userData = doc.data();
      const memberCard = createMemberCard(userData, doc.id, true);
      memberGrid.appendChild(memberCard);
    });

  } catch (error) {
    console.error('Error loading pending members:', error);
  }
}

// Function to create a member card
function createMemberCard(userData, userId, isPending = false) {
  const memberCard = document.createElement('div');
  memberCard.className = 'member-card';

  // Create avatar
  const avatar = document.createElement('div');
  avatar.className = 'member-avatar';
  
  // Use email or name to generate avatar
  const email = userData.email || '';
  const name = userData.name || email.split('@')[0] || 'User';
  
  // Simple avatar generation
  if (email.includes('unsplash') || userData.profileImage) {
    const img = document.createElement('img');
    img.src = userData.profileImage || `https://images.unsplash.com/photo-1494790108755-2616b612b786?w=40&h=40&fit=crop&crop=face`;
    img.alt = name;
    avatar.appendChild(img);
  } else {
    const colors = ['default-avatar', 'purple-avatar', 'blue-avatar', 'green-avatar', 'orange-avatar'];
    const colorClass = colors[name.charCodeAt(0) % colors.length];
    avatar.className = `member-avatar ${colorClass}`;
    avatar.innerHTML = `<span>${name.charAt(0).toUpperCase()}</span>`;
  }

  // Create member info
  const memberInfo = document.createElement('div');
  memberInfo.className = 'member-info';
  
  const memberName = document.createElement('div');
  memberName.className = 'member-name';
  memberName.textContent = name;
  
  const memberEmail = document.createElement('div');
  memberEmail.className = 'member-email';
  // Truncate email if too long
  const truncatedEmail = email.length > 15 ? email.substring(0, 15) + '...' : email;
  memberEmail.textContent = truncatedEmail;
  
  memberInfo.appendChild(memberName);
  memberInfo.appendChild(memberEmail);

  // Create action button
  const actionBtn = document.createElement('button');
  
if (isPending) {
    // Create container for both buttons
    const buttonContainer = document.createElement('div');
    buttonContainer.style.display = 'flex';
    buttonContainer.style.gap = '8px';
    
    // Accept button
    const acceptBtn = document.createElement('button');
    acceptBtn.className = 'accept-btn';
    acceptBtn.innerHTML = `
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="12" r="9" fill="#22c55e" fill-opacity="0.3"/>
        <circle cx="12" cy="12" r="9" stroke="#22c55e" stroke-width="2"/>
        <path d="M9 12L11 14L15 10" stroke="#22c55e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    `;
    acceptBtn.addEventListener('click', () => handleAcceptPendingMember(userId));
    
    // Delete button
    actionBtn.className = 'delete-btn';
    actionBtn.innerHTML = `
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M6 7L6 20C6 21.1046 6.89543 22 8 22L16 22C17.1046 22 18 21.1046 18 20L18 7L6 7Z" fill="#9ca3af" fill-opacity="0.3"/>
        <rect x="4" y="5" width="16" height="2" rx="1" fill="#9ca3af" fill-opacity="0.2"/>
        <path d="M6 7L6 20C6 21.1046 6.89543 22 8 22L16 22C17.1046 22 18 21.1046 18 20L18 7M6 7L18 7M6 7L4 7M18 7L20 7" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"/>
        <path d="M10 4L10 6M14 4L14 6" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"/>
        <line x1="10" y1="10" x2="10" y2="18" stroke="#9ca3af" stroke-width="1.5" stroke-linecap="round" opacity="0.7"/>
        <line x1="14" y1="10" x2="14" y2="18" stroke="#9ca3af" stroke-width="1.5" stroke-linecap="round" opacity="0.7"/>
      </svg>
    `;
    actionBtn.addEventListener('click', () => handleDeletePendingMember(userId));
    
    buttonContainer.appendChild(acceptBtn);
    buttonContainer.appendChild(actionBtn);
    
    // Use buttonContainer instead of actionBtn for the final append
    memberCard.appendChild(avatar);
    memberCard.appendChild(memberInfo);
    memberCard.appendChild(buttonContainer);
    return memberCard;
    
    actionBtn.className = 'menu-btn';
    actionBtn.textContent = '‚ãÆ';
  }

  // Assemble the card
  memberCard.appendChild(avatar);
  memberCard.appendChild(memberInfo);
  memberCard.appendChild(actionBtn);

  return memberCard;
}

// Function to handle accepting a pending member
async function handleAcceptPendingMember(userId) {
  try {
    await db.collection('users').doc(userId).update({
      needsApproval: false,
      approvalStatus: 'approved'
    });
    
    // Reload pending members
    loadPendingMembers();
  } catch (error) {
    console.error('Error accepting pending member:', error);
  }
}

// Function to handle deleting/rejecting a pending member
async function handleDeletePendingMember(userId) {
  try {
    // You can either delete the user or update their status
    // For this example, we'll update needsApproval to false (rejected)
    await db.collection('users').doc(userId).update({
      needsApproval: false,
      approvalStatus: 'rejected'
    });
    
    // Reload pending members
    loadPendingMembers();
  } catch (error) {
    console.error('Error handling pending member:', error);
  }
}

async function loadApprovedMembers() {
  try {
    const advisorSchool = await getCurrentAdvisorSchool();
    if (!advisorSchool) return;

    // Query users with approvalStatus: 'approved' and same school
    const approvedQuery = db.collection('users')
      .where('approvalStatus', '==', 'approved')
      .where('school', '==', advisorSchool);

    const snapshot = await approvedQuery.get();
    
    // Get the workspace members container
    const memberGrid = document.querySelector('.workspace-section .member-grid');
    if (!memberGrid) return;

    // Clear existing content
    memberGrid.innerHTML = '';

    // Update the count in the header
    const workspaceHeader = document.querySelector('.workspace-section h2');
    if (workspaceHeader) {
      workspaceHeader.textContent = `Workspace member (${snapshot.size})`;
    }

    // Create member cards for each approved user
    snapshot.forEach((doc) => {
      const userData = doc.data();
      const memberCard = createApprovedMemberCard(userData, doc.id);
      memberGrid.appendChild(memberCard);
    });

  } catch (error) {
    console.error('Error loading approved members:', error);
  }
}

// Function to create approved member card
function createApprovedMemberCard(userData, userId) {
  const memberCard = document.createElement('div');
  memberCard.className = 'member-card';

  // Create avatar
  const avatar = document.createElement('div');
  avatar.className = 'member-avatar';
  
  const email = userData.email || '';
  const name = userData.name || email.split('@')[0] || 'User';
  
  // Simple avatar generation
  if (userData.profileImage) {
    const img = document.createElement('img');
    img.src = userData.profileImage;
    img.alt = name;
    avatar.appendChild(img);
  } else {
    const colors = ['default-avatar', 'purple-avatar', 'blue-avatar', 'green-avatar', 'orange-avatar'];
    const colorClass = colors[name.charCodeAt(0) % colors.length];
    avatar.className = `member-avatar ${colorClass}`;
    avatar.innerHTML = `<span>${name.charAt(0).toUpperCase()}</span>`;
  }

  // Create member info
  const memberInfo = document.createElement('div');
  memberInfo.className = 'member-info';
  
  const memberName = document.createElement('div');
  memberName.className = 'member-name';
  
  // Add role badge if officer
  let nameText = name;
  if (userData.role === 'officer') {
    nameText += ' <span class="owner-badge">Officer</span>';
  }
  memberName.innerHTML = nameText;
  
  const memberEmail = document.createElement('div');
  memberEmail.className = 'member-email';
  memberEmail.textContent = email;
  
  memberInfo.appendChild(memberName);
  memberInfo.appendChild(memberEmail);

  // Create menu button
  const menuBtn = document.createElement('button');
  menuBtn.className = 'menu-btn';
  menuBtn.style.background = 'none';
  menuBtn.style.border = 'none';
  menuBtn.style.cursor = 'pointer';
  menuBtn.textContent = '‚ãÆ';

  // Assemble the card
  memberCard.appendChild(avatar);
  memberCard.appendChild(memberInfo);
  memberCard.appendChild(menuBtn);

  return memberCard;
}

// Initialize when auth state changes
// Initialize when auth state changes
auth.onAuthStateChanged((user) => {
  if (user) {
    loadPendingMembers();
    loadApprovedMembers(); // Add this line
  }
});

// Also load when page loads if user is already authenticated
document.addEventListener('DOMContentLoaded', () => {
  if (auth.currentUser) {
    loadPendingMembers();
    loadApprovedMembers(); // Add this line
  }
});
// Function to load approved workspace members


  </script>
    </body>
    </html>